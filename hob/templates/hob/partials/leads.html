<div class="table-container">
    <div style="padding: 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <h3 style="margin: 0; font-size: 1.25rem; font-weight: 600;">All Leads</h3>
        
        <!-- Filters -->
        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
            <!-- Source Filter -->
            <select id="sourceFilter" onchange="filterLeads()" style="background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 0.5rem; font-size: 0.9rem;">
                <option value="">All Sources</option>
                {% for value, label in source_choices %}
                    <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
            </select>
            
            <!-- Status Filter -->
            <input type="text" id="statusFilter" oninput="filterLeads()" placeholder="Filter by status..." style="background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 0.5rem; font-size: 0.9rem; min-width: 150px;">
            
            <!-- Staff Filter -->
            <select id="staffFilter" onchange="filterLeads()" style="background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 0.5rem; font-size: 0.9rem;">
                <option value="">All Staff</option>
                {% for staff in staff_members %}
                    <option value="{{ staff.id }}">{{ staff.get_full_name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    
    <div class="table-scroll-vert">
        <table class="bc-table bc-table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Source</th>
                    <th>Status</th>
                    <th>Program</th>
                    <th>Assigned To</th>
                    <th>Created</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in leads %}
                <tr class="lead-row" 
                    data-source="{{ lead.source }}"
                    data-status="{{ lead.status|lower }}"
                    data-staff="{{ lead.assigned_to.id|default:'' }}">
                    <td>
                        <a href="{% url 'accounts:lead_details' lead.id %}" style="color: var(--accent); text-decoration: none; font-weight: 500;">
                            {{ lead.name }}
                        </a>
                    </td>
                    <td>{{ lead.phone }}</td>
                    <td>
                        <span style="padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; background: rgba(59, 130, 246, 0.2); color: #93c5fd;">
                            {{ lead.source }}
                        </span>
                    </td>
                    <td>
                        <span style="padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; background: rgba(156, 163, 175, 0.2); color: #9ca3af;">
                            {{ lead.status }}
                        </span>
                    </td>
                    <td>{{ lead.program|default:"-" }}</td>
                    <td>{{ lead.assigned_to.get_full_name|default:"Unassigned" }}</td>
                    <td>{{ lead.created_at|date:"M d, Y" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                        No leads found
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function filterLeads() {
    const sourceFilter = document.getElementById('sourceFilter').value;
    const statusFilter = document.getElementById('statusFilter').value.toLowerCase();
    const staffFilter = document.getElementById('staffFilter').value;
    
    const rows = document.querySelectorAll('.lead-row');
    let visibleCount = 0;
    
    rows.forEach(row => {
        const source = row.dataset.source;
        const status = row.dataset.status;
        const staff = row.dataset.staff;
        
        const sourceMatch = !sourceFilter || source === sourceFilter;
        const statusMatch = !statusFilter || status.includes(statusFilter);
        const staffMatch = !staffFilter || staff === staffFilter;
        
        if (sourceMatch && statusMatch && staffMatch) {
            row.style.display = '';
            visibleCount++;
        } else {
            row.style.display = 'none';
        }
    });
    
    // Show message if no results
    let noResults = document.querySelector('.no-results-message');
    if (visibleCount === 0) {
        if (!noResults) {
            noResults = document.createElement('tr');
            noResults.className = 'no-results-message';
            noResults.innerHTML = '<td colspan="7" style="text-align: center; color: var(--text-secondary); padding: 2rem;">No leads match the selected filters</td>';
            document.querySelector('tbody').appendChild(noResults);
        }
    } else if (noResults) {
        noResults.remove();
    }
}
</script>