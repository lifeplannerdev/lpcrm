<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employees - HR Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    :root {
      --bg-primary: #000000;
      --bg-secondary: #0a0a0a;
      --card-bg: #111111;
      --border-color: #2a2a2a;
      --border-hover: #3a3a3a;
      --text-primary: #ededed;
      --text-secondary: #a1a1aa;
      --text-tertiary: #71717a;
      --accent: #0070f3;
      --accent-hover: #0761d1;
      --success: #00e599;
      --warning: #f5a623;
      --error: #e00;
      --shadow: 0 0 0 1px rgba(255, 255, 255, 0.03);
      --glow: 0 0 20px rgba(0, 112, 243, 0.3);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Vercel-style grid background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 0;
    }
    
    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      position: relative;
      z-index: 1;
    }
    
    .dashboard-header {
      margin-bottom: 3rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1.5rem;
    }
    
    .dashboard-title {
      font-size: clamp(1.75rem, 3vw, 2.5rem);
      font-weight: 800;
      letter-spacing: -0.05em;
      background: linear-gradient(to right, var(--text-primary), var(--text-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .header-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .action-btn {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      font-family: inherit;
    }
    
    .action-btn:hover {
      background: var(--card-bg);
      color: var(--text-primary);
      border-color: var(--border-hover);
    }
    
    /* Vercel-style tabs */
    .tabs-container {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
    }
    
    .tabs-header {
      background: transparent;
      padding: 0.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      gap: 0.25rem;
    }
    
    .tab {
      flex: 1;
      padding: 0.625rem 1rem;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.875rem;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      border-radius: 6px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
      font-family: inherit;
      white-space: nowrap;
    }
    
    .tab:hover {
      color: var(--text-primary);
      background: rgba(255, 255, 255, 0.05);
    }
    
    .tab.active {
      color: var(--text-primary);
      background: var(--bg-secondary);
      box-shadow: var(--shadow);
    }
    
    .tab-content {
      padding: 1.5rem;
      min-height: 400px;
      position: relative;
    }
    
    .tab-pane {
      display: none;
      animation: fadeIn 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .tab-pane.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { 
        opacity: 0;
        transform: translateY(4px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Table styling */
    .table-wrapper {
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
    }
    
    .table-scroll {
      max-height: 65vh;
      overflow-y: auto;
      overflow-x: auto;
    }
    
    .table-scroll::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    .table-scroll::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .table-scroll::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
    }
    
    .table-scroll::-webkit-scrollbar-thumb:hover {
      background: var(--border-hover);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }
    
    th, td {
      padding: 0.875rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    th {
      background: var(--bg-secondary);
      color: var(--text-secondary);
      font-weight: 600;
      font-size: 0.8125rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    td {
      color: var(--text-primary);
    }
    
    tbody tr {
      transition: background 0.15s ease;
    }
    
    tbody tr:hover {
      background: rgba(255, 255, 255, 0.02);
    }
    
    tbody tr:last-child td {
      border-bottom: none;
    }
    
    /* Avatar */
    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #00e599);
      color: white;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.75rem;
      vertical-align: middle;
      margin-right: 0.75rem;
    }
    
    .employee-info {
      display: flex;
      align-items: center;
    }
    
    .employee-details {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }
    
    .employee-name {
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .employee-email {
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }
    
    /* Badges */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.625rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      border: 1px solid;
    }
    
    .badge-success {
      background: rgba(0, 229, 153, 0.1);
      color: var(--success);
      border-color: rgba(0, 229, 153, 0.2);
    }
    
    .badge-warning {
      background: rgba(245, 166, 35, 0.1);
      color: var(--warning);
      border-color: rgba(245, 166, 35, 0.2);
    }
    
    .badge-error {
      background: rgba(238, 0, 0, 0.1);
      color: var(--error);
      border-color: rgba(238, 0, 0, 0.2);
    }
    
    .badge-neutral {
      background: rgba(161, 161, 170, 0.1);
      color: var(--text-secondary);
      border-color: var(--border-color);
    }
    
    /* Task cards */
    .task-grid {
      display: grid;
      gap: 0.75rem;
    }
    
    .task-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }
    
    .task-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-1px);
    }
    
    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
      gap: 1rem;
    }
    
    .task-title {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.9375rem;
    }
    
    .task-badges {
      display: flex;
      gap: 0.5rem;
      flex-shrink: 0;
    }
    
    .task-description {
      color: var(--text-secondary);
      font-size: 0.875rem;
      line-height: 1.5;
      margin-bottom: 0.75rem;
    }
    
    .task-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8125rem;
      color: var(--text-tertiary);
    }
    
    .task-assignee {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .task-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #00e599);
      color: white;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.625rem;
    }
    
    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-secondary);
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }
    
    .empty-state h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }
    
    /* Loading state */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 3rem;
      color: var(--text-secondary);
    }
    
    .loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-color);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Toast Notification Styles */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      padding: 16px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      max-width: 400px;
      animation: toastSlideIn 0.3s ease-out;
      transform-origin: top right;
      position: relative;
    }

    @keyframes toastSlideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast-success {
      background: linear-gradient(135deg, #00e599, #00c885);
      border-left: 4px solid #00ffaa;
    }

    .toast-error {
      background: linear-gradient(135deg, #ff4d4d, #e60000);
      border-left: 4px solid #ff3333;
    }

    .toast-info {
      background: linear-gradient(135deg, #4d94ff, #1a75ff);
      border-left: 4px solid #3399ff;
    }

    .toast-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .toast-content {
      flex: 1;
      font-size: 14px;
    }

    .toast-close {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background 0.2s;
    }

    .toast-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .toast-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: rgba(255, 255, 255, 0.3);
      width: 100%;
      transform-origin: left;
      animation: toastProgress 5s linear forwards;
    }

    @keyframes toastProgress {
      from {
        transform: scaleX(1);
      }
      to {
        transform: scaleX(0);
      }
    }

    /* View Penalty Modal Styles */
    .penalty-details-view {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .detail-section {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
    }

    .detail-item.full-width {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .detail-item label {
      font-weight: 600;
      color: var(--text-secondary);
      min-width: 120px;
      font-size: 0.9rem;
    }

    .detail-value {
      color: var(--text-primary);
      text-align: right;
      flex: 1;
      font-size: 0.95rem;
    }

    .detail-item.full-width .detail-value {
      text-align: left;
    }

    .amount-text {
      color: #ff4d4d;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .act-text {
      color: var(--text-primary);
      line-height: 1.4;
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: rgba(0, 229, 153, 0.1);
      color: var(--success);
      border: 1px solid rgba(0, 229, 153, 0.3);
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border-color);
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .dashboard-container {
        padding: 1.5rem;
      }
      
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
    }
    
    @media (max-width: 768px) {
      .dashboard-container {
        padding: 1rem;
      }
      
      .dashboard-title {
        font-size: 1.5rem;
      }
      
      .tab {
        padding: 0.5rem 0.75rem;
        font-size: 0.8125rem;
      }
      
      .tab-content {
        padding: 1rem;
      }
      
      th, td {
        padding: 0.75rem 0.625rem;
        font-size: 0.8125rem;
      }
      
      .employee-email {
        display: none;
      }
    }
    
    @media (max-width: 480px) {
      .tab {
        padding: 0.5rem;
        font-size: 0.75rem;
      }
      
      .header-controls {
        width: 100%;
      }
      
      .action-btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
      <h1 class="dashboard-title">Employee Management</h1>
      <div class="header-controls">
        <button class="action-btn">
          <i class="fas fa-arrow-left"></i>
          <span>Back</span>
        </button>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs-header">
        <button class="tab active" data-tab="employees">Employees</button>
        <button class="tab" data-tab="attendance">Attendance</button>
        <button class="tab" data-tab="tasks">Penalties</button>
      </div>
      
      <div class="tab-content">
        <!-- Employees Tab -->
        <div class="tab-pane active" id="employees-tab">
          <div id="employees-content">
            <div class="loading"></div>
          </div>
        </div>
        
        <!-- Attendance Tab -->
        <div class="tab-pane" id="attendance-tab">
          <div id="attendance-content">
            <div class="loading"></div>
          </div>
        </div>
        
        <!-- Penalties Tab -->
        <div class="tab-pane" id="tasks-tab">
          <div id="tasks-content">
            <div class="loading"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

 

  <script>
    // Toast Notification Functions
    let toastContainer = null;

    function createToastContainer() {
      if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container';
        document.body.appendChild(toastContainer);
      }
      return toastContainer;
    }

    function showToast(message, type = 'info', duration = 5000) {
      // Create toast container if it doesn't exist
      const container = createToastContainer();
      
      // Create toast element
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      
      // Add icon based on type
      const icon = document.createElement('span');
      icon.className = 'toast-icon';
      if (type === 'success') {
        icon.innerHTML = '&#10003;'; // Checkmark
      } else if (type === 'error') {
        icon.innerHTML = '&#10005;'; // Cross
      } else {
        icon.innerHTML = '&#8505;'; // Info
      }
      
      // Add content
      const content = document.createElement('div');
      content.className = 'toast-content';
      content.textContent = message;
      
      // Add close button
      const closeBtn = document.createElement('button');
      closeBtn.className = 'toast-close';
      closeBtn.innerHTML = '&times;';
      closeBtn.onclick = () => {
        toast.remove();
      };
      
      // Add progress bar
      const progress = document.createElement('div');
      progress.className = 'toast-progress';
      
      // Assemble toast
      toast.appendChild(icon);
      toast.appendChild(content);
      toast.appendChild(closeBtn);
      toast.appendChild(progress);
      
      // Add to container
      container.appendChild(toast);
      
      // Auto remove after duration
      const timer = setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
      }, duration);
      
      // Pause timer on hover
      toast.addEventListener('mouseenter', () => {
        progress.style.animationPlayState = 'paused';
        clearTimeout(timer);
      });
      
      toast.addEventListener('mouseleave', () => {
        progress.style.animationPlayState = 'running';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.remove();
          }
        }, duration - 1000);
      });
    }

    // Global function to initialize penalties delete buttons
    function initializePenaltiesDeleteButtons() {
      console.log('Initializing penalties delete buttons...');
      const deleteButtons = document.querySelectorAll('.delete-penalty-btn');
      console.log('Found', deleteButtons.length, 'delete buttons to initialize');
      
      deleteButtons.forEach(button => {
        const penaltyId = button.getAttribute('data-penalty-id');
        console.log('Button with penalty ID:', penaltyId);
      });
    }

    // Global delete function for penalties
    function deletePenalty(penaltyId, buttonElement) {
      console.log('Delete function called for penalty ID:', penaltyId);
      
      if (confirm('Are you sure you want to delete this penalty?')) {
        // Get CSRF token
        let csrfToken = '';
        const csrfElement = document.querySelector('[name=csrfmiddlewaretoken]');
        if (csrfElement) {
          csrfToken = csrfElement.value;
        }
        
        if (!csrfToken) {
          alert('Security token not found. Please refresh the page.');
          return;
        }
        
        console.log('CSRF Token found, sending DELETE request...');
        
        // Show loading state
        const originalHTML = buttonElement.innerHTML;
        buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        buttonElement.disabled = true;
        
        // Send DELETE request to server
        fetch(`/hr/penalties/delete/${penaltyId}/`, {
          method: 'DELETE',
          headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          console.log('Response status:', response.status);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          console.log('Response data:', data);
          if (data.status === 'success') {
            // Show success message
            showToast('Penalty deleted successfully!', 'success');
            
            // Remove the penalty card from the DOM with animation
            const penaltyCard = buttonElement.closest('.penalty-card');
            if (penaltyCard) {
              penaltyCard.style.opacity = '0';
              penaltyCard.style.transform = 'translateX(100px)';
              setTimeout(() => {
                penaltyCard.remove();
                
                // Check if no penalties left and show empty state
                const penaltyGrid = document.querySelector('.penalty-grid');
                if (penaltyGrid && penaltyGrid.children.length === 0) {
                  // Reload the penalties content to show empty state
                  const tasksContent = document.getElementById('tasks-content');
                  if (tasksContent) {
                    tasksContent.innerHTML = '<div class="loading"></div>';
                    // Use the existing loadTabContent function
                    loadTabContent('tasks');
                  }
                }
              }, 300);
            }
          } else {
            throw new Error(data.message || 'Unknown error occurred');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          const errorMessage = error.message || 'An error occurred while deleting the penalty';
          showToast('Error: ' + errorMessage, 'error');
          
          // Restore button state
          buttonElement.innerHTML = originalHTML;
          buttonElement.disabled = false;
        });
      }
    }

    // View penalty details function
    function viewPenaltyDetails(penaltyId, buttonElement) {
      console.log('View details function called for penalty ID:', penaltyId);
      
      // Get the penalty card element
      const penaltyCard = buttonElement.closest('.penalty-card');
      
      // Extract data from the penalty card
      const employeeName = penaltyCard.querySelector('.employee-name').textContent;
      const employeePosition = penaltyCard.querySelector('.employee-position').textContent;
      const penaltyAct = penaltyCard.querySelector('.act-text').textContent;
      const penaltyAmount = penaltyCard.querySelector('.penalty-amount').textContent.replace('Amount: ₹', '');
      const penaltyMonth = penaltyCard.querySelector('.penalty-month').textContent.replace('Month: ', '');
      const penaltyDate = penaltyCard.querySelector('.penalty-date').textContent.replace('Date: ', '');
      
      // Populate the view modal
      document.getElementById('viewEmployeeName').textContent = employeeName;
      document.getElementById('viewEmployeePosition').textContent = employeePosition;
      document.getElementById('viewEmployeeEmail').textContent = 'Not available'; // You might want to add email to your model
      document.getElementById('viewPenaltyAct').textContent = penaltyAct;
      document.getElementById('viewPenaltyAmount').textContent = `₹${penaltyAmount}`;
      document.getElementById('viewPenaltyMonth').textContent = penaltyMonth;
      document.getElementById('viewPenaltyDate').textContent = penaltyDate;
      
      // Show the view modal
      const viewModal = document.getElementById('viewPenaltyModal');
      viewModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
      
      // Add animation
      setTimeout(() => {
        viewModal.style.opacity = '1';
      }, 10);
    }

    // Close view modal function
    function closeViewModal() {
      const viewModal = document.getElementById('viewPenaltyModal');
      if (viewModal) {
        viewModal.style.opacity = '0';
        setTimeout(() => {
          viewModal.style.display = 'none';
          document.body.style.overflow = '';
        }, 300);
      }
    }

    // Close add penalty modal function
    function closeAddPenaltyModal() {
      const addModal = document.getElementById('addPenaltyModal');
      if (addModal) {
        addModal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    // Modal management functions for penalties
    function initializePenaltiesModals() {
      console.log('Initializing penalties modals...');
      
      // View Penalty Modal
      const viewModal = document.getElementById('viewPenaltyModal');
      const closeViewModalBtn = document.getElementById('closeViewModal');
      const closeViewDetailsBtn = document.getElementById('closeViewDetails');
      
      if (viewModal && closeViewModalBtn) {
        console.log('Found view modal close button');
        closeViewModalBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Close view modal button clicked');
          closeViewModal();
        });
      } else {
        console.log('View modal close button not found');
      }
      
      if (viewModal && closeViewDetailsBtn) {
        console.log('Found close view details button');
        closeViewDetailsBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Close view details button clicked');
          closeViewModal();
        });
      } else {
        console.log('Close view details button not found');
      }
      
      // Click outside to close view modal
      if (viewModal) {
        viewModal.addEventListener('click', function(e) {
          if (e.target === viewModal) {
            console.log('Clicked outside view modal, closing...');
            closeViewModal();
          }
        });
      }
      
      // Add Penalty Modal
      const addModal = document.getElementById('addPenaltyModal');
      const closeAddModalBtn = document.getElementById('closeModal');
      const cancelAddPenaltyBtn = document.getElementById('cancelAddPenalty');
      const addPenaltyBtn = document.getElementById('addPenaltyBtn');
      
      if (addModal && closeAddModalBtn) {
        console.log('Found add penalty modal close button');
        closeAddModalBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Close add penalty modal button clicked');
          closeAddPenaltyModal();
        });
      }
      
      if (addModal && cancelAddPenaltyBtn) {
        console.log('Found cancel add penalty button');
        cancelAddPenaltyBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Cancel add penalty button clicked');
          closeAddPenaltyModal();
        });
      }
      
      // Click outside to close add modal
      if (addModal) {
        addModal.addEventListener('click', function(e) {
          if (e.target === addModal) {
            console.log('Clicked outside add penalty modal, closing...');
            closeAddPenaltyModal();
          }
        });
      }
      
      // Add Penalty Button
      if (addPenaltyBtn) {
        console.log('Found add penalty button');
        addPenaltyBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Add penalty button clicked');
          const addModal = document.getElementById('addPenaltyModal');
          if (addModal) {
            addModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('penaltyDate');
            if (dateInput && !dateInput.value) {
              dateInput.value = today;
            }
          }
        });
      }
      
      // Add Penalty Form Submission
      const addPenaltyForm = document.getElementById('addPenaltyForm');
      if (addPenaltyForm) {
        console.log('Found add penalty form');
        addPenaltyForm.addEventListener('submit', function(e) {
          e.preventDefault();
          console.log('Penalty form submitted');
          
          const formData = new FormData(this);
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
          
          const submitBtn = this.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.textContent = 'Adding...';
          submitBtn.disabled = true;
          
          fetch('/hr/penalties/add/', {
            method: 'POST',
            body: formData,
            headers: {
              'X-CSRFToken': csrfToken
            }
          })
          .then(response => response.json())
          .then(data => {
            if (data.status === 'success') {
              showToast('Penalty added successfully!', 'success');
              closeAddPenaltyModal();
              
              // RELOAD ONLY THE PENALTIES CONTENT (NOT THE ENTIRE PAGE)
              setTimeout(() => {
                // Force reload the penalties tab content
                const tasksContent = document.getElementById('tasks-content');
                if (tasksContent) {
                  tasksContent.innerHTML = '<div class="loading"></div>';
                  if (typeof loadTabContent === 'function') {
                    loadTabContent('tasks');
                  }
                }
              }, 500);
              
            } else {
              showToast('Error: ' + (data.message || 'Unknown error'), 'error');
              submitBtn.textContent = originalText;
              submitBtn.disabled = false;
            }
          })
          .catch(error => {
            console.error('Error:', error);
            showToast('An error occurred. Please try again.', 'error');
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
          });
        });
      }
    }

    // Enhanced event delegation for penalties
    document.addEventListener('click', function(e) {
      // Handle view button clicks for penalties
      if (e.target.closest('.view-penalty-btn')) {
        e.preventDefault();
        e.stopPropagation();
        
        const button = e.target.closest('.view-penalty-btn');
        const penaltyId = button.getAttribute('data-penalty-id');
        
        if (penaltyId) {
          console.log('View button clicked via event delegation for penalty ID:', penaltyId);
          viewPenaltyDetails(penaltyId, button);
        } else {
          console.error('No penalty ID found on view button');
        }
        return;
      }
      
      // Handle delete button clicks for penalties
      if (e.target.closest('.delete-penalty-btn')) {
        e.preventDefault();
        e.stopPropagation();
        
        const button = e.target.closest('.delete-penalty-btn');
        const penaltyId = button.getAttribute('data-penalty-id');
        
        if (penaltyId) {
          console.log('Delete button clicked via event delegation for penalty ID:', penaltyId);
          deletePenalty(penaltyId, button);
        } else {
          console.error('No penalty ID found on delete button');
        }
        return;
      }
    });

    // Tab switching functionality
    document.addEventListener('DOMContentLoaded', function() {
      const tabs = document.querySelectorAll('.tab');
      const tabPanes = document.querySelectorAll('.tab-pane');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          
          // Remove active class from all tabs and panes
          tabs.forEach(t => t.classList.remove('active'));
          tabPanes.forEach(pane => pane.classList.remove('active'));
          
          // Add active class to clicked tab and corresponding pane
          this.classList.add('active');
          const activePane = document.getElementById(`${tabId}-tab`);
          activePane.classList.add('active');
          
          // Load content dynamically if not already loaded
          loadTabContent(tabId);
        });
      });
      
      // Add hover effects to action buttons
      const actionBtns = document.querySelectorAll('.action-btn');
      actionBtns.forEach(btn => {
        btn.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-2px)';
        });
        btn.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
        });
      });
      
      // Back button functionality
      const backBtn = document.querySelector('.header-controls .action-btn');
      if (backBtn) {
        backBtn.addEventListener('click', function() {
          // Redirect to HR dashboard
          window.location.href = '/hr/';
        });
      }
      
      // Load initial content
      loadTabContent('employees');
    });
    
    // Function to load tab content dynamically
    function loadTabContent(tabId) {
      const contentDiv = document.getElementById(`${tabId}-content`);
      
      // Check if content is already loaded
      if (contentDiv && (contentDiv.innerHTML.trim() === '' || contentDiv.querySelector('.loading'))) {
        // Make AJAX request to load the content
        fetch(getTabUrl(tabId))
          .then(response => response.text())
          .then(html => {
            contentDiv.innerHTML = html;
            // Re-initialize any JavaScript functionality if needed
            initializeTabContent(tabId);
          })
          .catch(error => {
            console.error('Error loading tab content:', error);
            contentDiv.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><h3>Error Loading Content</h3><p>Failed to load tab content. Please try again.</p></div>';
          });
      }
    }
    
    // Function to get the URL for each tab
    function getTabUrl(tabId) {
      const baseUrl = window.location.origin;
      switch(tabId) {
        case 'employees':
          return `${baseUrl}/hr/employees/list/`;
        case 'attendance':
          return `${baseUrl}/hr/attendance/`;
        case 'tasks':
          return `${baseUrl}/hr/penalties/`;
        default:
          return `${baseUrl}/hr/employees/list/`;
      }
    }
    
    // Function to initialize tab-specific content
    function initializeTabContent(tabId) {
      console.log('Initializing tab content for:', tabId);
      
      switch(tabId) {
        case 'employees':
          // Initialize employee search functionality
          console.log('Employees tab loaded, checking for initialization');
          
          // Add a small delay to ensure DOM is fully rendered
          setTimeout(function() {
            // Manually attach event listeners to the buttons
            console.log('Attaching event listeners to employee buttons');
            
            // Add employee button
            const addEmployeeBtn = document.getElementById('add-employee-btn');
            console.log('Add employee button:', addEmployeeBtn);
            if (addEmployeeBtn) {
              addEmployeeBtn.addEventListener('click', function(e) {
                console.log('Add employee button clicked from main initialization');
                e.preventDefault();
                // Directly show the modal
                const modal = document.getElementById('addEmployeeModal');
                if (modal) {
                  modal.style.display = 'flex';
                  document.body.style.overflow = 'hidden';
                  console.log('Modal displayed via main initialization');
                }
              });
              console.log('Attached click listener to add employee button');
            }
            
            // Test modal button
            const testModalBtn = document.getElementById('test-modal-btn');
            console.log('Test modal button:', testModalBtn);
            if (testModalBtn) {
              testModalBtn.addEventListener('click', function(e) {
                console.log('Test modal button clicked from main initialization');
                e.preventDefault();
                // Directly show the modal
                const modal = document.getElementById('addEmployeeModal');
                if (modal) {
                  modal.style.display = 'flex';
                  document.body.style.overflow = 'hidden';
                  console.log('Modal displayed via main initialization');
                }
              });
              console.log('Attached click listener to test modal button');
            }
            
            // Add first employee button (in empty state)
            const addFirstEmployeeBtn = document.getElementById('add-first-employee');
            if (addFirstEmployeeBtn) {
              addFirstEmployeeBtn.addEventListener('click', function(e) {
                e.preventDefault();
                // Directly show the modal
                const modal = document.getElementById('addEmployeeModal');
                if (modal) {
                  modal.style.display = 'flex';
                  document.body.style.overflow = 'hidden';
                }
              });
            }
            
            // Form submission functionality
            const addEmployeeForm = document.getElementById('addEmployeeForm');
            if (addEmployeeForm) {
              // Remove any existing event listeners to prevent duplicates
              const newForm = addEmployeeForm.cloneNode(true);
              addEmployeeForm.parentNode.replaceChild(newForm, addEmployeeForm);
              
              newForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(this);
                
                // Get CSRF token
                const csrfTokenInput = this.querySelector('input[name=csrfmiddlewaretoken]');
                const csrfToken = csrfTokenInput ? csrfTokenInput.value : null;
                
                if (!csrfToken) {
                  showToast('Security token not found. Please refresh the page and try again.', 'error');
                  return;
                }
                
                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Adding...';
                submitBtn.disabled = true;
                
                // Submit via AJAX
                fetch('/hr/employees/add/', {
                  method: 'POST',
                  body: formData,
                  headers: {
                    'X-CSRFToken': csrfToken
                  }
                })
                .then(response => {
                  if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.status);
                  }
                  return response.json();
                })
                .then(data => {
                  if (data.status === 'success') {
                    showToast('Employee added successfully!', 'success');
                    // Close modal
                    const modal = document.getElementById('addEmployeeModal');
                    if (modal) {
                      modal.style.display = 'none';
                      document.body.style.overflow = '';
                    }
                    // Reload to show new employee after a short delay to ensure toast is visible
                    setTimeout(function() {
                      try {
                        window.location.reload();
                      } catch (e) {
                        // Fallback: redirect to the employees page
                        window.location.href = '/hr/employees/';
                      }
                    }, 1500);
                  } else {
                    showToast('Error: ' + (data.message || 'Unknown error occurred'), 'error');
                  }
                })
                .catch(error => {
                  showToast('An error occurred while adding the employee. Please try again. Error: ' + error.message, 'error');
                })
                .finally(() => {
                  // Restore button state
                  submitBtn.textContent = originalText;
                  submitBtn.disabled = false;
                });
              });
            }
            
            // Close modal functionality
            const modal = document.getElementById('addEmployeeModal');
            if (modal) {
              // Close button
              const closeBtn = modal.querySelector('.close-modal');
              if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                  modal.style.display = 'none';
                  document.body.style.overflow = '';
                });
              }
              
              // Cancel button
              const cancelBtn = document.getElementById('cancelAddEmployee');
              if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                  modal.style.display = 'none';
                  document.body.style.overflow = '';
                });
              }
              
              // Click outside to close
              modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                  modal.style.display = 'none';
                  document.body.style.overflow = '';
                }
              });
            }
            
            // Delete employee functionality for dynamically loaded content
            setTimeout(function() {
              document.querySelectorAll('.delete-employee').forEach(btn => {
                btn.addEventListener('click', function(e) {
                  e.preventDefault();
                  const employeeId = this.getAttribute('data-employee-id');
                  const employeeName = this.closest('tr').querySelector('.employee-name').textContent;
                  
                  // Confirm deletion
                  if (confirm(`Are you sure you want to delete ${employeeName}? This action cannot be undone.`)) {
                    // Get CSRF token
                    const csrfTokenElement = document.querySelector('[name=csrfmiddlewaretoken]');
                    if (!csrfTokenElement) {
                      showToast('Security token not found. Please refresh the page and try again.', 'error');
                      return;
                    }
                    const csrfToken = csrfTokenElement.value;
                    
                    // Send DELETE request
                    fetch(`/hr/employees/delete/${employeeId}/`, {
                      method: 'DELETE',
                      headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                      }
                    })
                    .then(response => response.json())
                    .then(data => {
                      if (data.status === 'success') {
                        showToast('Employee deleted successfully!', 'success');
                        // Remove the employee row from the table
                        this.closest('tr').remove();
                      } else {
                        showToast('Error deleting employee: ' + data.message, 'error');
                      }
                    })
                    .catch(error => {
                      showToast('An error occurred while deleting the employee.', 'error');
                    });
                  }
                });
              });
            }, 500);
          }, 500); // Small delay to ensure DOM is ready
          break;
          
        case 'attendance':
          // Initialize attendance-specific functionality
          break;
          
        case 'tasks':
          // Initialize penalties modal functionality
          console.log('Initializing penalties tab');
          
          setTimeout(function() {
            console.log('Setting up penalties modals and buttons...');
            
            // Initialize penalties modals and buttons
            if (typeof initializePenaltiesModals === 'function') {
              initializePenaltiesModals();
            }
            if (typeof initializePenaltiesDeleteButtons === 'function') {
              initializePenaltiesDeleteButtons();
            }
            
            console.log('Penalties tab fully initialized!');
          }, 500);
          break;
      }
    }
  </script>
</body>
</html>