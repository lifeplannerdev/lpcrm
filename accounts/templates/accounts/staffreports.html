<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff Reports - LP CRM</title>
  <!-- Basecoat CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/basecoat-css@0.2.8/dist/basecoat.cdn.min.css">
  <script src="https://cdn.jsdelivr.net/npm/basecoat-css@0.2.8/dist/js/all.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    :root {
      --bg-primary: #000000;
      --bg-secondary: #0a0a0a;
      --card-bg: #111111;
      --border-color: #1f1f1f;
      --border-hover: #333333;
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-tertiary: #71717a;
      --accent: #ffffff;
      --accent-hover: #f4f4f5;
      --shadow-small: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-large: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    body {
      background: var(--bg-primary);
      background-image: 
        radial-gradient(circle at 25% 25%, #1f1f1f 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, #1a1a1a 0%, transparent 50%);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh; line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }
    .dashboard-header {
      margin-bottom: 3rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .dashboard-title {
      font-size: clamp(2rem, 4vw, 2.5rem);
      font-weight: 700;
      letter-spacing: -0.025em;
      background: linear-gradient(135deg, #989595 0%, #45454a 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .header-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .btn {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      margin-right: 0.2rem;
    }
    .btn-primary {
      background: var(--accent);
      color: var(--bg-primary);
    }
    .btn-primary:hover, .btn-primary:active {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }
    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }
    .btn-secondary:hover {
      background: var(--border-hover);
      border-color: var(--border-hover);
    }
    .btn:disabled {
      background: var(--border-color);
      color: var(--text-tertiary);
      cursor: not-allowed;
      transform: none;
    }
    .btn:disabled:hover {
      background: var(--border-color);
      transform: none;
    }
    .tabs-container {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 1rem;
    }
    .tab {
      padding: 0.75rem 1.5rem;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .tab.active {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }
    .tab:hover:not(.active) {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-primary);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .form-container {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 2rem;
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow-large);
      margin-bottom: 2rem;
    }
    .form-group {
      margin-bottom: 1.5rem;
    }
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
      font-weight: 500;
    }
    .form-input, .form-textarea {
      width: 100%;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      font-size: 1rem;
      transition: border 0.2s ease;
    }
    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    .form-textarea {
      min-height: 150px;
      resize: vertical;
    }
    .table-container {
      background: var(--card-bg);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow-large);
    }
    .table-scroll-vert {
      max-height: 70vh;
      overflow-y: auto;
      overflow-x: hidden;
      position: relative;
      width: 100%;
      padding-right: 8px;
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
    }
    .table-scroll-vert::-webkit-scrollbar {
      width: 6px;
    }
    .table-scroll-vert::-webkit-scrollbar-track {
      background: transparent;
      border-radius: 3px;
    }
    .table-scroll-vert::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }
    .table-scroll-vert::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    table.bc-table {
      background: var(--card-bg);
      color: var(--text-primary);
      border-radius: 0;
      border: none;
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    .bc-table th, .bc-table td {
      background: transparent;
      color: var(--text-primary);
      border: none;
      font-size: 1rem;
      padding: 1.05rem 0.9rem;
      vertical-align: middle;
      transition: background 0.18s;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .bc-table th:first-child {
      width: 60px;
      text-align: center;
      font-weight: 600;
      color: var(--text-secondary);
    }
    .bc-table td:first-child {
      width: 60px;
      text-align: center;
      font-weight: 600;
      color: var(--text-secondary);
      background: rgba(255, 255, 255, 0.02);
    }
    .bc-table th {
      background: var(--bg-secondary);
      font-weight: 600;
      letter-spacing: 0.04em;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .bc-table-striped tbody tr:nth-child(odd) {
      background: rgba(255,255,255,0.01);
    }
    .bc-table tbody tr {
      border-bottom: 1px solid var(--border-color);
      transition: background 0.18s, box-shadow 0.18s;
    }
    .bc-table tbody tr:last-child {
      border-bottom: none;
    }
    .bc-table tbody tr:hover {
      background: rgba(255,255,255,0.03);
      box-shadow: 0 2px 8px 0 rgba(0,0,0,0.10);
    }
    .report-content {
      max-height: 100px;
      overflow: hidden;
      position: relative;
    }
    .report-content.expanded {
      max-height: none;
    }
    .read-more {
      position: absolute;
      bottom: 0;
      right: 0;
      background: linear-gradient(to right, transparent, var(--card-bg) 50%);
      padding-left: 2rem;
      color: var(--accent);
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 500;
    }
    .report-date {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    .report-heading {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .toast-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      color: white;
      font-weight: 500;
      z-index: 10000;
      animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .toast-notification.success {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.9) 0%, rgba(16, 185, 129, 0.8) 100%);
    }
    .toast-notification.error {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.9) 0%, rgba(239, 68, 68, 0.8) 100%);
    }
    .toast-notification.warning {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.9) 0%, rgba(245, 158, 11, 0.8) 100%);
    }
    .toast-notification.fade-out {
      animation: slideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    @keyframes slideIn {
      from { 
        transform: translateX(100%) scale(0.95); 
        opacity: 0; 
      }
      to { 
        transform: translateX(0) scale(1); 
        opacity: 1; 
      }
    }
    @keyframes slideOut {
      from { 
        transform: translateX(0) scale(1); 
        opacity: 1; 
      }
      to { 
        transform: translateX(100%) scale(0.95); 
        opacity: 0; 
      }
    }
    .search-container {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    .search-box {
      position: relative;
      display: flex;
      align-items: center;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0.5rem;
      transition: border 0.18s;
      min-width: 300px;
    }
    .search-box:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
    }
    .search-icon {
      color: var(--text-secondary);
      margin-right: 0.5rem;
      font-size: 0.9rem;
    }
    .search-input {
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 0.9rem;
      flex: 1;
      outline: none;
    }
    .search-input::placeholder {
      color: var(--text-tertiary);
    }
    .clear-search {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 4px;
      transition: color 0.18s;
    }
    .clear-search:hover {
      color: var(--text-primary);
    }
    .no-results {
      text-align: center;
      padding: 2rem;
      color: var(--text-secondary);
      font-style: italic;
    }
    @media (max-width: 1200px) {
      .dashboard-container { padding:1rem }
      .dashboard-header { flex-direction: column; align-items: flex-start }
      .header-controls { flex-direction: column; align-items: stretch; gap: 0.5rem; }
      .bc-table th, .bc-table td { padding: 0.75rem 0.5rem; font-size: 0.9rem; }
      .search-box { min-width: 250px; }
    }
    @media (max-width: 768px) {
      .dashboard-container { padding:0.5rem }
      .dashboard-header { gap: 0.6rem }
      .form-container { padding: 1rem; }
      .bc-table th, .bc-table td { padding: 0.5rem 0.3rem; font-size: 0.8rem; }
      .table-scroll-vert { max-height: 60vh; }
      .search-box { min-width: 200px; padding: 0.4rem; }
      .search-input { font-size: 0.8rem; }
      .tabs-container { flex-direction: column; }
      .tab { text-align: center; }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="dashboard-header">
      <h1 class="dashboard-title">STAFF REPORTS</h1>
      <div class="header-controls">
        <button class="btn btn-secondary" onclick="window.history.back()">
          <i class="fas fa-arrow-left"></i>
          <span>Back</span>
        </button>
      </div>
    </div>

    <div class="tabs-container">
      <button class="tab active" data-tab="new-report">New Report</button>
      <button class="tab" data-tab="report-history">Report History</button>
    </div>

    <!-- New Report Tab -->
    <div id="new-report" class="tab-content active">
      <div class="form-container">
        <form id="dailyReportForm">
          {% csrf_token %}
          <div class="form-group">
            <label class="form-label" for="reportName">Report Name</label>
            <input type="text" id="reportName" class="form-input" placeholder="Give a title to your daily report" required>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="reportHeading">Report Heading</label>
            <input type="text" id="reportHeading" class="form-input" placeholder="Brief summary of your daily report" required>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="reportText">Daily Update</label>
            <textarea id="reportText" class="form-textarea" placeholder="Share your daily progress and updates" required></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="reportDate">Report Date</label>
            <input type="date" id="reportDate" class="form-input" required>
          </div>
          
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i>
            <span>Submit Report</span>
          </button>
        </form>
      </div>
    </div>

    <!-- Report History Tab -->
    <div id="report-history" class="tab-content">
      <div class="search-container">
        <div class="search-box">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="searchReports" placeholder="Search reports..." class="search-input">
          <button id="clearSearchReports" class="clear-search" style="display: none;">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <div class="table-container">
        <div class="table-scroll-vert">
          <table class="bc-table bc-table-striped">
            <thead>
              <tr>
                <th>#</th>
                <th>Report Name</th>
                <th>Heading</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="reportsTableBody">
              {% for report in reports %}
              <tr class="report-row" 
                  data-name="{{ report.name|lower }}"
                  data-heading="{{ report.heading|lower }}"
                  data-date="{{ report.report_date|date:'Y-m-d' }}">
                <td>{{ forloop.counter }}</td>
                <td>
                  <div class="report-heading">{{ report.name }}</div>
                </td>
                <td>
                  <div class="report-content">
                    {{ report.heading }}
                    <span class="read-more" onclick="toggleReadMore(this)">Read more</span>
                  </div>
                </td>
                <td>
                  <div class="report-date">
                    {{ report.report_date|date:"M d, Y" }}
                    {% if report.is_today_report %}
                    <span style="color: #34d399; font-weight: 600;">(Today)</span>
                    {% endif %}
                  </div>
                </td>
                <td>
                  <button class="btn btn-secondary view-report" data-report-id="{{ report.id }}">
                    <i class="fas fa-eye"></i>
                    <span>View</span>
                  </button>
                  <button class="btn btn-primary edit-report" data-report-id="{{ report.id }}">
                    <i class="fas fa-edit"></i>
                    <span>Edit</span>
                  </button>
                  <button class="btn btn-secondary delete-report" data-report-id="{{ report.id }}" style="background: #ef4444; color: white;">
                    <i class="fas fa-trash"></i>
                    <span>Delete</span>
                  </button>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="no-results">No reports found</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Report Modal -->
  <div id="reportModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: var(--card-bg); border-radius: 16px; padding: 2rem; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border-color); position: relative;">
      <button id="closeModal" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">
        <i class="fas fa-times"></i>
      </button>
      <h2 id="modalTitle" style="margin-bottom: 1.5rem; color: var(--text-primary);">Report Details</h2>
      <div id="modalContent">
        <!-- Report content will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // CSRF helper for axios
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }
    axios.defaults.headers.common['X-CSRFToken'] = getCookie('csrftoken');
    axios.defaults.xsrfCookieName = 'csrftoken';
    axios.defaults.xsrfHeaderName = 'X-CSRFToken';
    
    // Tab functionality
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', function() {
        // Remove active class from all tabs
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Add active class to clicked tab
        this.classList.add('active');
        
        // Show corresponding content
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });
    
    // Set today's date as default for report date
    document.getElementById('reportDate').valueAsDate = new Date();
    
    // Form submission - CREATE new report
    document.getElementById('dailyReportForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData();
      formData.append('name', document.getElementById('reportName').value);
      formData.append('heading', document.getElementById('reportHeading').value);
      formData.append('report_text', document.getElementById('reportText').value);
      formData.append('report_date', document.getElementById('reportDate').value);
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
      
      // If we're editing, use PUT, otherwise POST for creation
      const isEditing = this.dataset.editingId;
      const url = isEditing ? `/accounts/reports/${this.dataset.editingId}/update/` : '{% url "accounts:staff_reports" %}';
      const method = isEditing ? 'put' : 'post';
      
      axios({
        method: method,
        url: url,
        data: formData,
        headers: {
          'Content-Type': 'multipart/form-data',
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(response => {
        showToast(isEditing ? 'Report updated successfully!' : 'Report submitted successfully!', 'success');
        document.getElementById('dailyReportForm').reset();
        document.getElementById('reportDate').valueAsDate = new Date();
        
        // Remove editing state
        if (isEditing) {
          delete this.dataset.editingId;
          this.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save"></i><span>Submit Report</span>';
        }
        
        // Refresh the page to show updated reports
        setTimeout(() => {
          window.location.reload();
        }, 1000);
      })
      .catch(error => {
        console.error('Error submitting report:', error);
        showToast('Failed to submit report. Please try again.', 'error');
      });
    });
    
    // Search functionality for reports
    const searchReportsInput = document.getElementById('searchReports');
    const clearSearchReportsBtn = document.getElementById('clearSearchReports');
    
    function performReportSearch() {
      const searchTerm = searchReportsInput.value.toLowerCase().trim();
      const reportRows = document.querySelectorAll('.report-row');
      let visibleCount = 0;
      
      reportRows.forEach(row => {
        const name = row.dataset.name;
        const heading = row.dataset.heading;
        const date = row.dataset.date;
        
        if (name.includes(searchTerm) ||
            heading.includes(searchTerm) ||
            date.includes(searchTerm)) {
          row.style.display = '';
          visibleCount++;
        } else {
          row.style.display = 'none';
        }
      });
      
      // Show/hide clear button
      clearSearchReportsBtn.style.display = searchTerm ? 'block' : 'none';
      
      // Show no results message if needed
      let noResultsRow = document.querySelector('.no-results-row');
      if (visibleCount === 0 && searchTerm) {
        if (!noResultsRow) {
          noResultsRow = document.createElement('tr');
          noResultsRow.className = 'no-results-row';
          noResultsRow.innerHTML = '<td colspan="5" class="no-results">No reports found matching your search</td>';
          document.getElementById('reportsTableBody').appendChild(noResultsRow);
        }
      } else if (noResultsRow) {
        noResultsRow.remove();
      }
    }
    
    searchReportsInput.addEventListener('input', performReportSearch);
    clearSearchReportsBtn.addEventListener('click', () => {
      searchReportsInput.value = '';
      performReportSearch();
      searchReportsInput.focus();
    });
    
    // Read more functionality
    function toggleReadMore(element) {
      const content = element.parentElement;
      content.classList.toggle('expanded');
      element.textContent = content.classList.contains('expanded') ? 'Read less' : 'Read more';
    }
    
    // View report functionality
    document.addEventListener('click', function(e) {
      if (e.target.closest('.view-report')) {
        const reportId = e.target.closest('.view-report').getAttribute('data-report-id');
        viewReport(reportId);
      }
      
      if (e.target.closest('.edit-report')) {
        const reportId = e.target.closest('.edit-report').getAttribute('data-report-id');
        editReport(reportId);
      }
      
      if (e.target.closest('.delete-report')) {
        const reportId = e.target.closest('.delete-report').getAttribute('data-report-id');
        deleteReport(reportId);
      }
    });
    
    function viewReport(reportId) {
      axios.get(`/accounts/reports/${reportId}/`)
        .then(response => {
          const report = response.data;
          document.getElementById('modalTitle').textContent = report.name;
          document.getElementById('modalContent').innerHTML = `
            <div style="margin-bottom: 1rem;">
              <strong>Date:</strong> ${new Date(report.report_date).toLocaleDateString()}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Heading:</strong> ${report.heading}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Report:</strong>
              <div style="margin-top: 0.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px; white-space: pre-wrap;">${report.report_text}</div>
            </div>
          `;
          document.getElementById('reportModal').style.display = 'flex';
        })
        .catch(error => {
          console.error('Error loading report:', error);
          showToast('Failed to load report details.', 'error');
        });
    }
    
    function editReport(reportId) {
      // Switch to new report tab and populate form with existing data
      document.querySelector('[data-tab="new-report"]').click();
      
      axios.get(`/accounts/reports/${reportId}/`)
        .then(response => {
          const report = response.data;
          document.getElementById('reportName').value = report.name;
          document.getElementById('reportHeading').value = report.heading;
          document.getElementById('reportText').value = report.report_text;
          document.getElementById('reportDate').value = report.report_date;
          
          // Change form submission to update instead of create
          const form = document.getElementById('dailyReportForm');
          form.dataset.editingId = reportId;
          form.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save"></i><span>Update Report</span>';
          
          showToast('Report loaded for editing.', 'success');
        })
        .catch(error => {
          console.error('Error loading report for editing:', error);
          showToast('Failed to load report for editing.', 'error');
        });
    }
    
    function deleteReport(reportId) {
      if (confirm('Are you sure you want to delete this report? This action cannot be undone.')) {
        axios.delete(`/accounts/reports/${reportId}/delete/`)
          .then(response => {
            showToast('Report deleted successfully!', 'success');
            // Remove the row from the table
            document.querySelector(`.report-row[data-report-id="${reportId}"]`).remove();
            // Refresh the table if empty
            if (document.querySelectorAll('.report-row').length === 0) {
              window.location.reload();
            }
          })
          .catch(error => {
            console.error('Error deleting report:', error);
            showToast('Failed to delete report.', 'error');
          });
      }
    }
    
    // Close modal
    document.getElementById('closeModal').addEventListener('click', function() {
      document.getElementById('reportModal').style.display = 'none';
    });
    
    // Close modal when clicking outside
    document.getElementById('reportModal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.style.display = 'none';
      }
    });
    
    // Toast notification function
    function showToast(message, type) {
      const toast = document.createElement('div');
      toast.className = `toast-notification ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('fade-out');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>